<!doctype html>
<html lang="ru" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>XKeen UI</title>
    <link rel="icon" type="image/png" href="favicon.png" />
    <link rel="apple-touch-icon" href="favicon.png" />
    <link rel="preload" href="/assets/JetBrainsMono-Regular-Latin.woff2" as="font" type="font/woff2" crossorigin />
    <link rel="preload" href="/assets/JetBrainsMono-Regular-Cyrillic.woff2" as="font" type="font/woff2" crossorigin />
    <link rel="stylesheet" href="style.css" />
  </head>

  <body>
    <div class="container">
      <div class="statusBar">
        <div class="statusBar-left">
          <div class="status" id="statusIndicator">
            <span id="statusText">Проверка статуса...</span>
          </div>

          <div id="controlsSkeletons" class="controls-skeletons" style="display: inline-flex; gap: 8px">
            <div class="skeleton skeleton-btn" style="width: 30px; height: 30px"></div>
            <div class="skeleton skeleton-btn" style="width: 30px; height: 30px"></div>
          </div>

          <div class="controls-buttons">
            <button
              class="btn btn-primary btn-icon"
              id="restartBtn"
              style="display: none"
              onclick="hardRestart()"
              title="Перезапустить"
            ></button>
            <button class="btn btn-success btn-icon" id="startBtn" style="display: none" onclick="startXKeen()" title="Запустить"></button>
            <button class="btn btn-danger btn-icon" id="stopBtn" style="display: none" onclick="stopXKeen()" title="Остановить"></button>
          </div>
        </div>

        <h1 class="title">XKeen UI</h1>

        <div class="statusBar-right">
          <div id="coreSelectSkeleton" class="skeleton skeleton-btn" style="width: 130px; height: 36px; display: inline-block"></div>
          <button id="coreSelectBtn" class="btn-core-select" style="display: none" onclick="openCoreManageModal()">
            <span class="core-icon" aria-hidden="true">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="core-icon" aria-hidden="true" focusable="false">
                <path d="M12 20a8 8 0 1 0 0-16 8 8 0 0 0 0 16Z" />
                <path d="M12 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z" />
                <path d="M12 2v2" />
                <path d="M12 22v-2" />
                <path d="m17 20.66-1-1.73" />
                <path d="M11 10.27 7 3.34" />
                <path d="m20.66 17-1.73-1" />
                <path d="m3.34 7 1.73 1" />
                <path d="M14 12h8" />
                <path d="M2 12h2" />
                <path d="m20.66 7-1.73 1" />
                <path d="m3.34 17 1.73-1" />
                <path d="m17 3.34-1 1.73" />
                <path d="m11 13.73-4 6.93" />
              </svg>
            </span>
            <span class="label" id="coreSelectLabel">xray</span>
            <span id="coreVersion" style="opacity: 0.5; font-size: 0.8em"></span>
          </button>
          <div id="settingsBtnSkeleton" class="skeleton skeleton-btn" style="width: 36px; height: 36px; display: inline-block"></div>
          <button id="settingsBtn" class="btn-icon btn-secondary" style="display: none" onclick="toggleSettingsModal()" title="Настройки">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path
                d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"
              />
              <circle cx="12" cy="12" r="3" />
            </svg>
          </button>
        </div>
      </div>

      <div class="panel">
        <div class="panel-header-config">
          <div class="panel-title-container">
            <h2 class="panel-title">Конфигурация</h2>
            <a id="dashboardLink" href="#" target="_blank" style="display: none">
              <span class="text">Dashboard</span>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path
                  d="M20.2929 9.70708C20.5789 9.99307 21.009 10.0786 21.3827 9.92385C21.7564 9.76907 22 9.40443 22 8.99997V2.99997C22 2.44768 21.5523 1.99997 21 1.99997H15C14.5955 1.99997 14.2309 2.24361 14.0761 2.61729C13.9213 2.99096 14.0069 3.42108 14.2929 3.70708L16.2322 5.64641L9.58574 12.2929C9.19522 12.6834 9.19522 13.3166 9.58574 13.7071L10.2928 14.4142C10.6834 14.8048 11.3165 14.8048 11.7071 14.4142L18.3536 7.76774L20.2929 9.70708Z"
                />
                <path
                  d="M4.5 8.00006C4.5 7.72392 4.72386 7.50006 5 7.50006H10.0625C10.6148 7.50006 11.0625 7.05234 11.0625 6.50006V5.50006C11.0625 4.94777 10.6148 4.50006 10.0625 4.50006H5C3.067 4.50006 1.5 6.06706 1.5 8.00006V19.0001C1.5 20.9331 3.067 22.5001 5 22.5001H16C17.933 22.5001 19.5 20.9331 19.5 19.0001V13.9376C19.5 13.3853 19.0523 12.9376 18.5 12.9376H17.5C16.9477 12.9376 16.5 13.3853 16.5 13.9376V19.0001C16.5 19.2762 16.2761 19.5001 16 19.5001H5C4.72386 19.5001 4.5 19.2762 4.5 19.0001V8.00006Z"
                />
              </svg>
            </a>
          </div>
          <div class="tabs-scroll">
            <div class="tab-group core-group">
              <div class="tabs-list" id="coreTabsList"></div>
            </div>
            <div class="tab-group xkeen-group">
              <div class="tabs-list" id="xkeenTabsList"></div>
            </div>
          </div>
        </div>

        <div class="tabs-content">
          <div class="editor-container" id="editorContainer">
            <div class="editor-loading">Загрузка конфигураций...</div>
          </div>
        </div>

        <div class="validation-info" id="validationInfo" style="display: none">
          <div id="validationMessageContainer"></div>
          <div id="validationSkeleton" class="skeleton skeleton-line"></div>
          <div class="editor-controls" id="editorControlsContainer">
            <div id="editorControlsSkeletons" class="controls-skeletons">
              <div id="saveRestartBtn-skeleton" class="skeleton skeleton-btn" style="width: 164px"></div>
              <div id="saveBtn-skeleton" class="skeleton skeleton-btn" style="width: 125px"></div>
              <div id="formatBtn-skeleton" class="skeleton skeleton-btn" style="width: 106px"></div>
            </div>
            <button class="btn btn-success" id="saveRestartBtn" onclick="saveAndRestart()" disabled>Применить</button>
            <button class="btn btn-primary" id="saveBtn" onclick="saveCurrentConfig()" disabled>Сохранить</button>
            <div class="btn-group">
              <button id="formatBtn" class="btn btn-secondary" onclick="formatCurrentConfig()">Формат</button>
              <button
                id="formatDropdownBtn"
                class="btn btn-secondary btn-dropdown"
                onclick="toggleFormatMenu(event)"
                disabled
                style="display: none"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <line x1="4" y1="6" x2="20" y2="6"></line>
                  <line x1="4" y1="12" x2="20" y2="12"></line>
                  <line x1="4" y1="18" x2="20" y2="18"></line>
                </svg>
              </button>
              <div id="formatMenu" class="format-menu">
                <div
                  class="format-menu-item"
                  onclick="
                    openImportModal()
                    toggleFormatMenu()
                  "
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                    <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                  </svg>
                  Импорт подключения
                </div>
                <div
                  class="format-menu-item"
                  onclick="
                    event.stopPropagation()
                    openTemplateImportModal()
                    toggleFormatMenu()
                  "
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                    <line x1="12" y1="18" x2="12" y2="12"></line>
                    <line x1="9" y1="15" x2="15" y2="15"></line>
                  </svg>
                  Импорт шаблона
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="panel" id="logsPanel">
        <div class="panel-header">
          <h2 class="panel-title">Журнал</h2>
          <div class="panel-actions">
            <div class="log-filter">
              <input id="logFilterInput" class="input" type="text" placeholder="Фильтр" aria-label="Фильтр строк журнала" />
              <button class="log-filter-clear" id="logFilterClear" aria-label="Очистить"></button>
            </div>

            <div class="log-controls">
              <div id="logSelectRoot" class="select-root" aria-label="Выбор файла логов">
                <button id="logSelectTrigger" class="select-trigger" aria-haspopup="listbox" aria-expanded="false">
                  <span class="label" id="logSelectLabel">error.log</span>
                  <svg class="chevron" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                  </svg>
                </button>
                <div id="logSelectContent" class="select-content">
                  <div class="select-item" role="option" data-value="error.log" aria-selected="true">
                    error.log <span class="check">✓</span>
                  </div>
                  <div class="select-item" role="option" data-value="access.log" aria-selected="false">
                    access.log <span class="check">✓</span>
                  </div>
                </div>
              </div>
              <button
                id="clearLogBtn"
                class="clear-log-btn"
                onclick="clearCurrentLog()"
                title="Очистить текущий лог-файл"
                aria-label="Очистить текущий лог-файл"
              >
                <svg
                  class="clear-icon"
                  xmlns="http://www.w3.org/2000/svg"
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="tabler-icon tabler-icon-trash"
                >
                  <path d="M4 7l16 0"></path>
                  <path d="M10 11l0 6"></path>
                  <path d="M14 11l0 6"></path>
                  <path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12"></path>
                  <path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3"></path>
                </svg>
              </button>
            </div>
          </div>
        </div>
        <button id="expandLogBtn" class="log-overlay-btn" onclick="toggleLogFullscreen()" title="Развернуть">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="icon icon-tabler icons-tabler-outline icon-tabler-maximize"
          >
            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
            <path d="M4 8v-2a2 2 0 0 1 2 -2h2" />
            <path d="M4 16v2a2 2 0 0 0 2 2h2" />
            <path d="M16 4h2a2 2 0 0 1 2 2v2" />
            <path d="M16 20h2a2 2 0 0 0 2 -2v-2" />
          </svg>
        </button>
        <button id="scrollBottomBtn" class="log-overlay-btn scroll-bottom-btn" title="В самый низ">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="icon icon-tabler icons-tabler-outline icon-tabler-chevron-down"
          >
            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
            <path d="M6 9l6 6l6 -6" />
          </svg>
        </button>
        <div id="logsContainer" class="logs-container">
          <div
            style="
              color: #6b7280;
              text-align: center;
              position: absolute;
              top: 50%;
              left: 50%;
              transform: translate(-50%, -50%);
              width: 100%;
            "
          >
            Загрузка журнала...
          </div>
        </div>
      </div>
    </div>
    <div class="modal-overlay" id="dirtyModal">
      <div class="modal-content">
        <button class="modal-close" onclick="closeDirtyModal()" aria-label="Закрыть">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
        <h3 class="modal-title">Несохраненные изменения</h3>
        <p class="modal-body">
          В файле есть несохраненные изменения.<br />
          Сохранить их перед выходом?
        </p>
        <div class="modal-actions">
          <button class="btn btn-primary" id="saveAndSwitchBtn" onclick="saveAndSwitch()">Сохранить</button>
          <button class="btn btn-secondary" id="cancelSwitchBtn" onclick="discardAndSwitch()">Не сохранять</button>
        </div>
      </div>
    </div>
    <div class="modal-overlay" id="coreManageModal">
      <div class="modal-content">
        <button class="modal-close" onclick="closeCoreManageModal()" aria-label="Закрыть">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
        <h3 class="modal-title">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            style="display: inline-block; vertical-align: middle; margin-right: 10px; margin-top: -2px"
          >
            <path d="M12 20a8 8 0 1 0 0-16 8 8 0 0 0 0 16Z" />
            <path d="M12 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z" />
            <path d="M12 2v2" />
            <path d="M12 22v-2" />
            <path d="m17 20.66-1-1.73" />
            <path d="M11 10.27 7 3.34" />
            <path d="m20.66 17-1.73-1" />
            <path d="m3.34 7 1.73 1" />
            <path d="M14 12h8" />
            <path d="M2 12h2" />
            <path d="m20.66 7-1.73 1" />
            <path d="m3.34 17 1.73-1" />
            <path d="m17 3.34-1 1.73" />
            <path d="m11 13.73-4 6.93" />
          </svg>
          Управление ядром
        </h3>
        <div class="modal-body">
          <div class="core-manage-list">
            <div class="core-manage-item">
              <div class="core-manage-header">
                <h4>Xray</h4>
                <span class="core-manage-status" id="xrayStatus"></span>
              </div>
              <div class="core-manage-actions">
                <button class="btn btn-primary" id="xraySwitchBtn" onclick="switchCore('xray')">Переключить</button>
                <button class="btn btn-secondary" id="xrayUpdateBtn" onclick="openUpdateModal('xray')">Обновить</button>
              </div>
            </div>
            <div class="core-manage-item">
              <div class="core-manage-header">
                <h4>Mihomo</h4>
                <span class="core-manage-status" id="mihomoStatus"></span>
              </div>
              <div class="core-manage-actions">
                <button class="btn btn-primary" id="mihomoSwitchBtn" onclick="switchCore('mihomo')">Переключить</button>
                <button class="btn btn-secondary" id="mihomoUpdateBtn" onclick="openUpdateModal('mihomo')">Обновить</button>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-actions">
          <button class="btn btn-secondary" onclick="closeCoreManageModal()">Закрыть</button>
        </div>
      </div>
    </div>
    <div class="modal-overlay modal-template" id="updateModal">
      <div class="modal-content">
        <button class="modal-close" onclick="closeUpdateModal()" aria-label="Закрыть">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
        <h3 class="modal-title">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            style="display: inline-block; vertical-align: middle; margin-right: 10px; margin-top: -2px"
          >
            <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2" />
          </svg>
          Обновление&nbsp;<span id="updateModalCore"></span>
        </h3>
        <p class="template-modal-desc">
          <span id="updateModalDescription">Выберите версию для установки</span>
          <span class="template-count-badge" id="updateCountBadge">0</span>
        </p>
        <div class="modal-body">
          <div id="updateList" class="template-list"></div>
        </div>
        <div class="modal-actions">
          <button class="btn btn-primary" id="installVersionBtn" onclick="installSelectedVersion()" disabled>Установить</button>
          <button class="btn btn-secondary" onclick="closeUpdateModal()">Закрыть</button>
        </div>
      </div>
    </div>
    <script src="local_mode.js"></script>
    <script src="main.js"></script>
    <script src="outboundParser.js"></script>
    <script src="version.js"></script>
    <script src="guiRouting.js"></script>
    <script src="guiLog.js"></script>
    <div class="modal-overlay" id="importModal">
      <div class="modal-content">
        <button class="modal-close" onclick="closeImportModal()" aria-label="Закрыть">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
        <h3 class="modal-title">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            style="display: inline-block; vertical-align: middle; margin-right: 10px; margin-top: -2px"
          >
            <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
            <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
          </svg>
          Импорт подключения
        </h3>
        <p class="modal-description">Вставьте ссылку в формате protocol://</p>
        <div class="modal-body">
          <div class="import-input-wrapper">
            <input type="text" id="importInput" class="input" placeholder="vless://..." />
            <button class="import-input-clear" id="importInputClear" aria-label="Очистить"></button>
          </div>
          <div id="importResult" style="display: none">
            <div class="output-wrapper">
              <button class="copy-output-btn" id="copyBtn" onclick="copyImportResult()" title="Скопировать" style="display: none">
                <svg class="copy-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                  <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                </svg>
                <svg
                  class="check-icon"
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2.5"
                  style="display: none"
                >
                  <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
              </button>
              <textarea id="importOutput" readonly></textarea>
            </div>
          </div>
        </div>
        <div class="modal-actions">
          <button class="btn btn-primary" id="generateBtn" onclick="generateConfig()" disabled>Сгенерировать</button>
          <button class="btn btn-success" id="addBtn" onclick="addToOutbounds()" style="display: none">Добавить</button>
          <button class="btn btn-secondary" onclick="closeImportModal()">Закрыть</button>
        </div>
      </div>
    </div>
    <div class="modal-overlay modal-template" id="templateImportModal">
      <div class="modal-content">
        <button class="modal-close" onclick="closeTemplateImportModal()" aria-label="Закрыть">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
        <h3 class="modal-title">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            style="display: inline-block; vertical-align: middle; margin-right: 10px; margin-top: -2px"
          >
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <polyline points="14 2 14 8 20 8"></polyline>
            <line x1="12" y1="18" x2="12" y2="12"></line>
            <line x1="9" y1="15" x2="15" y2="15"></line>
          </svg>
          Импорт шаблона
        </h3>
        <p class="template-modal-desc">
          <span id="templateModalDescription">Выберите готовый шаблон конфигурации для быстрой настройки</span>
          <span class="template-count-badge" id="templateCountBadge">0</span>
        </p>
        <div class="modal-body">
          <div id="templateList" class="template-list"></div>
        </div>
        <div class="modal-actions">
          <button class="btn btn-primary" id="importTemplateBtn" onclick="importSelectedTemplate()" disabled>Импортировать</button>
          <button class="btn btn-secondary" onclick="closeTemplateImportModal()">Закрыть</button>
        </div>
      </div>
    </div>
    <a href="https://github.com/zxc-rv/XKeen-UI/releases" target="_blank" class="app-version" id="appVersion"
      ><span id="versionText">dev</span></a
    >
    <div class="fullscreen-backdrop" id="fullscreenBackdrop"></div>
    <div class="modal-overlay" id="settingsModal">
      <div class="modal-content">
        <button class="modal-close" onclick="closeSettingsModal()" aria-label="Закрыть">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
        <h3 class="modal-title">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            style="display: inline-block; vertical-align: middle; margin-right: 10px; margin-top: -2px"
          >
            <path
              d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"
            />
            <circle cx="12" cy="12" r="3" />
          </svg>
          Настройки
        </h3>
        <div class="modal-body settings-modal-body">
          <div class="settings-section">
            <h4 class="settings-section-title">Режим GUI</h4>
            <div class="settings-warning">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="19"
                height="19"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="icon icon-tabler icons-tabler-outline icon-tabler-alert-circle"
              >
                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                <path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0"></path>
                <path d="M12 8v4"></path>
                <path d="M12 16h.01"></path>
              </svg>
              <span> Функция является экспериментальной, перед включением сделайте бэкап конфигураций. Несовместимо с комментариями. </span>
            </div>
            <div class="settings-item">
              <span class="settings-item-label">Routing</span>
              <div class="routing-gui-toggle">
                <input type="checkbox" id="guiRoutingCheckboxSettings" onchange="toggleGuiRouting()" />
                <label for="guiRoutingCheckboxSettings"></label>
              </div>
            </div>
            <div class="settings-item">
              <span class="settings-item-label">Log</span>
              <div class="routing-gui-toggle">
                <input type="checkbox" id="guiLogCheckboxSettings" onchange="toggleGuiLog()" />
                <label for="guiLogCheckboxSettings"></label>
              </div>
            </div>
            <div class="settings-item">
              <span class="settings-item-label">Автоприменение</span>
              <div class="routing-gui-toggle">
                <input type="checkbox" id="autoApplyCheckbox" onchange="toggleAutoApply()" />
                <label for="autoApplyCheckbox"></label>
              </div>
            </div>
          </div>

          <div class="settings-section">
            <h4 class="settings-section-title">Обновление ядра</h4>
            <div class="settings-item">
              <span class="settings-item-label">Создавать бэкап ядра при обновлении</span>
              <div class="routing-gui-toggle">
                <input type="checkbox" id="backupCoreCheckbox" onchange="toggleBackupCore()" checked />
                <label for="backupCoreCheckbox"></label>
              </div>
            </div>
          </div>

          <div class="settings-section">
            <h4 class="settings-section-title">Журнал</h4>
            <div class="settings-item">
              <span class="settings-item-label">Часовой пояс</span>
              <div class="timezone-select-wrapper">
                <div class="custom-select timezone-select" id="timezoneSelect">
                  <div class="custom-select-trigger" onclick="toggleTimezoneSelect()">
                    <span id="timezoneLabel">UTC+3</span>
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                      <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                  </div>
                  <div class="custom-select-dropdown" id="timezoneDropdown"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-actions">
          <button class="btn btn-secondary" onclick="closeSettingsModal()">Закрыть</button>
        </div>
      </div>
    </div>
    <div class="modal-overlay" id="commentsWarningModal">
      <div class="modal-content">
        <button class="modal-close" onclick="closeCommentsWarning()" aria-label="Закрыть">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
        <h3 class="modal-title">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            style="display: inline-block; vertical-align: middle; margin-right: 10px; margin-top: -2px; color: #f59e0b"
          >
            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
            <line x1="12" y1="9" x2="12" y2="13"></line>
            <line x1="12" y1="17" x2="12.01" y2="17"></line>
          </svg>
          Предупреждение
        </h3>
        <p class="modal-body">
          В конфигурации найдены комментарии.<br />
          При сохранении через GUI они будут <b>утеряны</b>.<br /><br />
          Продолжить?
        </p>
        <div class="modal-actions">
          <button class="btn btn-primary" id="confirmCommentsBtn">Продолжить</button>
          <button class="btn btn-secondary" onclick="closeCommentsWarning()">Отмена</button>
        </div>
      </div>
    </div>
  </body>
</html>
